var genes = $('#search_genes').val();
$("#gene-search-results").append("<h3 id='searching-message'>Searching <%= @studies.size %> studies...");
<% @studies.each do |study| %>

  $("#gene-search-results").append("<%= escape_javascript(render partial: '/site/search/gene_search_panel', locals: {study: study}) %>")

  $.ajax({
      url: '<%= search_all_genes_path %>',
      method: 'POST',
      dataType: 'script',
      data: {
          search: {
              genes: genes
          },
          id: '<%= study.id %>',
          request_user_token: '<%= user_signed_in? ? current_user.id.to_s + ':' + current_user.authentication_token : nil %>'
      }
  });

<% end %>
<% search_genes = params[:search][:genes].split %>
var requestUrl = '<%= javascript_safe_url("/single_cell/search_all_genes?genes=#{search_genes.join('+')}&num_genes=#{search_genes.size}") %>';
gaTrack(requestUrl, 'Single Cell Portal | Global Gene Search');